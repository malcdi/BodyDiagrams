
<!--Description of the application
<div id="instructions">
<p> FREE HAND: mouse down and drag </p>
<p> REGION SELECT: double click & resize </p>
</div>-->


<div style="position: relative; margin-left: 40px; margin-right: 10px;">
  <div id="content-panel">
    <div id="canvasDiv" style="z-index: 1000"></div>

  <!-- Zoom/Drag Control -->
    <div id="toolboxes">
      <!--
      <div id="drawBrush" style="width:80px;height:30px;display:inline-block;">
        <img src="/assets/paint_brush.png" style="width:20px;height:20px;"/>
        <div style="width:60px;margin:0px 10px;display:inline-block;"></div>
      </div>
      -->

      <div class="prop_expand" id="prop_severity_expand">
        <div>Symptom Severity:</div>
      </div>

      <div class="prop_expand" id="prop_type_expand">
        <div>Symptom Type:</div>
        <textarea id="pain_type_tags" placeholder="Tags..." style="height:30px;padding:5px 8px;" rows="1"></textarea>
      </div>

      <div class="prop_expand" id="prop_layer_expand">
        <span>Symptom Layer:</span>
      </div>

      <div class="prop_expand" id="prop_freq_expand">
          <span>Symptom Postures:</span>
      </div>
    </div>

    <!-- Rotate left right image -->
    <div id="rotation_toolbox"> </div>

    <!-- Zoom Control -->
    <div id="zoomControl">
      <div style="position: absolute; width: 90px; height: 90px; " id="compassHolder"><div style="position: absolute; left: 16px; top: 17px; width:48px; height: 47px; overflow: hidden; "><img style="position: absolute; left: 0px; top: 0px; border: 0px; padding: 0px; margin: 0px;width:48px; height:370px " src="/assets/mapcontrols.png"></div></div>
      
      <div style="position: absolute; width: 90px; height: 90px; " id="compass"><div style="position: absolute; left: 30px; top: 17px; width: 18px; height: 18px; cursor: pointer; " title="Pan up"></div><div style="position: absolute; left: 16px; top: 30px; width: 18px; height: 18px; cursor: pointer; " title="Pan left"></div><div style="position: absolute; left: 46px; top: 30px; width: 18px; height: 18px; cursor: pointer; " title="Pan right" ></div><div style="position: absolute; left: 30px; top: 40px; width: 18px; height: 18px; cursor: pointer; " title="Pan down"></div></div>
      
      <div style="position: absolute; width: 22px; height: 22px; overflow: hidden; z-index: 101; " id="lmczoom"><div style="width: 22px; height: 22px; overflow: hidden; "><img style="position: absolute; left: 0px; top: -428px; border: 0px; padding: 0px; margin: 0px; " src="/assets/mapcontrols.png"></div><div style="position: absolute; left: 0px; top: 0px; width: 22px; height: 22px; cursor: pointer; " title="Zoom In"></div></div>
      
      <div style="position: absolute; width: 59px; height: 146px; overflow: hidden; " id="lmcslider"><div style="width: 59px; height: 277px; overflow: hidden; "><img style="position: absolute; left: 0px; top: -84px; border: 0px; padding: 0px; margin: 0px; " src="/assets/mapcontrols.png"></div></div>
      
      <div style="position: absolute; width: 59px; height: 22px; text-align: left; z-index: 103; " guidedhelpid="zoom_out" id="lmczo"><div style="width: 59px; height: 22px; overflow: hidden; position: absolute; "><img style="position: absolute; left: 0px; top: -361px; border: 0px; padding: 0px; margin: 0px; " src="/assets/mapcontrols.png"></div><div style="position: absolute; left: 16px; top: -4px; width: 26px; height: 26px; cursor: pointer; " title="Zoom Out"></div></div>
      
      <div style="position: absolute; width: 22px; height: 150px; z-index: 102; cursor: pointer; " id="lmczb" guidedhelpid="zoom_bar"><div style="width: 22px; height: 14px; overflow: hidden; position: absolute; cursor: url('/assets/dragCursor.cur'), default; left: 0px; top: 120px; " guidedhelpid="zoom_slider" id="lmczbg" title="Drag to zoom"><img style="position: absolute; left: 0px; top: -384px; border: 0px; padding: 0px; margin: 0px; " src="/assets/mapcontrols.png"></div></div>
    </div>

  </div>
</div>
<ul id="history_container"></ul>
  
<div id="instruction_container" style="position:absolute;top:10px;left:600px;width:400px">

  <h1><font color="#990000">INSTRUCTIONS</font></h1>
  <h2>1. Read this Prompt</h2>
      <font size="3">
      Hello,<br/>
      I was wondering if someone can help me figure out what is going on. For the past week I've been experiencing some serious joint pain. My joints ache all over my body at night; it is worst in my knees and shoulders. The pain is a dull but constant throbbing. Also, when I woke up this morning, my knees and ankles were swollen.<br/>
      <br/>
      I'm 21 years old, very active -- I love sports and especially hiking -- so I doubt this is arthritis. About a month ago I came back from a camping trip with the flu -- chills, fever etc.My muscles ached as though I had been lifting weights, and my neck was really stiff. It took longer than usual to clear (3 weeks). I don't know if this has anything to do with how I'm feeling now, but figured it was worth mentioning.<br/>
      <br/>
      Thanks, peace<br/>
      -MZ
      <br/>
      </font>

      <h2>2. Draw the condition</h2>
      <font size="3">Imagine that you wrote this prompt. Now use the BodyDiagrams interface to communicate the prompt condition. Imagine that you will submit your final result, *excluding the original prompt*, to an online community so that they can give you advice.<br/>
      </font>

      <h2>3. Click on "SUBMIT" to take our survey</h2>
      <font size="3">
      You will be issued a unique number; please keep this number to enter into the survey and into the original MTurk HIT. Thank you!
      
      <button type="button" id="submitTask">SUBMIT</button>
      </font>
</div>

<script type="text/javascript">
  var bigBro={};

  var userID = "<%=session[:user_id]%>"
  function getURLParameter(name) {
      return decodeURIComponent(
          (location.search.match(RegExp("[?|&]"+name+'=(.+?)(&|$)'))||[,null])[1]
      );  
  }
  
  function tagSelectionUpdate(index, select){
    bigBro.cvState.deHighlightFrame();
    if(index<0)
    {
      $("#annotator > div.annotator-widget").css({
        opacity:1.0
      });
    }

    var possibleTags = $("#pain_annotation_list").find(".annotator-widget");
    for(var i=0; i<possibleTags.length; i++){
      var theTagC =$(possibleTags[i])
      if(select && theTagC.find("#tag_"+index).length>0)
        theTagC.removeClass('annotator-list');
      else{
        theTagC.addClass('annotator-list');
      }
    }
    bigBro.cvState.highlightFrame(index);
  } 

  $(document).ready(function(){
    bigBro.ImageLoader = new window.ImageLoader();
    bigBro.currentView = 0;
    bigBro.currentGender = getURLParameter("gender"); 

    /* Canvas State */
    //current view side {0:front, 1: right, 2: back, 3: left}
    bigBro.width = 500;
    bigBro.height = 700;
    $('#content-panel').css({"width":bigBro.width+"px", "height":bigBro.height+"px"})
    $('#canvasDiv').css({"width":bigBro.width+"px", "height":bigBro.height+"px"})

    bigBro.propToolbox = new window.PropertyPopup("#toolboxes");
    bigBro.cvState = new CanvasState("#canvasDiv", {
      width:bigBro.width,
      height:bigBro.height,
      margin:20,
      currentGender:bigBro.currentGender,
      currentView:bigBro.currentView,
      mode:"zoom",
      imageLoader:bigBro.ImageLoader
    });

    bigBro.historyManager = new window.HistoryManager('#history_container', bigBro);
    var toolbox = new window.Toolbox("#toolboxes", "#rotation_toolbox", bigBro);
    
    
    /* Setting up Zoom Control*/
    var zoomController = new window.ZoomControl(bigBro);
    zoomController.setupControls(-20, 150);

    /* Submission */

    $( "#submitTask" ).click(function(){
      cvState.userID = userID;
      cvState.submitAll(getURLParameter("gender"));
    });

    window.attachEventListeners()
  });
</script>